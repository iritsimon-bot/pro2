# ×“×•×— ×‘×¢×™×•×ª ×§×™×™××•×ª ×•×‘×¢×™×•×ª ×§×œ××¡×™×•×ª ×‘× ×ª×•× ×™×

**×ª××¨×™×š:** ×“×¦××‘×¨ 2024  
**××¢×¨×š × ×ª×•× ×™×:** train.csv, test.csv, validation.csv

---

## ğŸ“‹ ×¡×™×›×•× ×× ×”×œ×™×

### ×‘×¢×™×•×ª ×§×¨×™×˜×™×•×ª ×©×–×•×”×•:

| # | ×‘×¢×™×” | ×—×•××¨×” | ×”×©×¤×¢×” |
|---|------|--------|--------|
| 1 | **Class Imbalance ×§×™×¦×•× ×™** | ğŸ”´ ×§×¨×™×˜×™ | ××•×“×œ×™× ×™×˜×• ×œ×§×œ××¡×™× × ×¤×•×¦×™× |
| 2 | **×§×œ××¡×™× × ×“×™×¨×™× ×××•×“** | ğŸ”´ ×§×¨×™×˜×™ | scRNA: 3-5 ×“×•×’×××•×ª ×‘×œ×‘×“ |
| 3 | **Data Leakage** | ğŸŸ  ×’×‘×•×” | Description ××’×œ×” GeneType |
| 4 | **×¨×¦×¤×™× ×§×¦×¨×™× ×××•×“** | ğŸŸ  ×’×‘×•×” | 5 ×¨×¦×¤×™× < 10 ×‘×¡×™×¡×™× |
| 5 | **×ª×™××•×¨×™× ×œ× ××•×‘× ×™×** | ğŸŸ¡ ×‘×™× ×•× ×™ | 589 ×’× ×™× "uncharacterized" |
| 6 | **×©×•× ×•×ª ×‘××•×¨×š ×¨×¦×¤×™×** | ğŸŸ¡ ×‘×™× ×•× ×™ | 2 ×¢×“ >1000 ×‘×¡×™×¡×™× |

---

## 1. ğŸ”´ ×‘×¢×™×” ×§×¨×™×˜×™×ª: Class Imbalance (×—×•×¡×¨ ××™×–×•×Ÿ ×§×œ××¡×™×)

### 1.1 ×ª×™××•×¨ ×”×‘×¢×™×”

×”×ª×¤×œ×’×•×ª GeneType ××¦×™×’×” **×—×•×¡×¨ ××™×–×•×Ÿ ×§×™×¦×•× ×™**:

#### ××¢×¨×š Train (22,593 ×¨×©×•××•×ª):
| GeneType | ×›××•×ª | ××—×•×– | ×™×—×¡ ×œ×§×˜×Ÿ |
|----------|------|------|----------|
| PSEUDO | 10,220 | **45.2%** | 3,407x |
| BIOLOGICAL_REGION | 6,925 | **30.7%** | 2,308x |
| ncRNA | 2,497 | 11.1% | 832x |
| snoRNA | 1,148 | 5.1% | 383x |
| PROTEIN_CODING | 524 | 2.3% | 175x |
| tRNA | 488 | 2.2% | 163x |
| OTHER | 366 | 1.6% | 122x |
| rRNA | 277 | 1.2% | 92x |
| snRNA | 145 | 0.6% | 48x |
| **scRNA** | **3** | **0.01%** | **1x** |

### 1.2 ×”×©×¤×¢×•×ª

- âŒ ××•×“×œ×™× ×™×˜×• ×œ×—×–×•×ª ×ª××™×“ PSEUDO ××• BIOLOGICAL_REGION
- âŒ Accuracy ××˜×¢×” (90%+ ×’× ×œ×œ× ×œ××™×“×” ×××™×ª×™×ª)
- âŒ ×§×œ××¡×™× × ×“×™×¨×™× ×œ× ×™×–×•×”×• ×›×œ×œ
- âŒ F1-score × ××•×š ×œ×§×œ××¡×™× ×§×˜× ×™×

### 1.3 ×¤×ª×¨×•× ×•×ª ××•××œ×¦×™×

#### ×. **Oversampling** (×”×’×“×œ×ª ×§×œ××¡×™× ×§×˜× ×™×):
```python
from imblearn.over_sampling import SMOTE, ADASYN

# SMOTE - ×™×¦×™×¨×ª ×“×•×’×××•×ª ×¡×™× ×ª×˜×™×•×ª
smote = SMOTE(random_state=42)
X_resampled, y_resampled = smote.fit_resample(X, y)

# ADASYN - ××ª××§×“ ×‘××–×•×¨×™× ×§×©×™×
adasyn = ADASYN(random_state=42)
X_resampled, y_resampled = adasyn.fit_resample(X, y)
```

#### ×‘. **Undersampling** (×”×§×˜× ×ª ×§×œ××¡×™× ×’×“×•×œ×™×):
```python
from imblearn.under_sampling import RandomUnderSampler

rus = RandomUnderSampler(random_state=42)
X_resampled, y_resampled = rus.fit_resample(X, y)
```

#### ×’. **Class Weights** (××©×§×•×œ×•×ª ×‘×”×¤×¡×“):
```python
from sklearn.utils.class_weight import compute_class_weight

class_weights = compute_class_weight('balanced', 
                                     classes=np.unique(y), 
                                     y=y)
# ×‘×©×™××•×© ×¢× ××•×“×œ:
model = RandomForestClassifier(class_weight='balanced')
```

#### ×“. **Focal Loss** (×œ×¨×©×ª×•×ª ×¢××•×§×•×ª):
```python
def focal_loss(gamma=2., alpha=.25):
    def focal_loss_fixed(y_true, y_pred):
        pt = y_true * y_pred + (1 - y_true) * (1 - y_pred)
        return -alpha * (1 - pt) ** gamma * K.log(pt + K.epsilon())
    return focal_loss_fixed
```

---

## 2. ğŸ”´ ×‘×¢×™×” ×§×¨×™×˜×™×ª: ×§×œ××¡×™× × ×“×™×¨×™× (Rare Classes)

### 2.1 ×ª×™××•×¨ ×”×‘×¢×™×”

| ×§×œ××¡ | Train | Test | Validation | ×¡×”"×› |
|------|-------|------|------------|------|
| scRNA | 3 | 1 | **0** | 4 |
| snRNA | 145 | 38 | 22 | 205 |
| rRNA | 277 | 72 | 8 | 357 |

**×‘×¢×™×” ×§×¨×™×˜×™×ª:** scRNA ×œ× ×§×™×™× ×›×œ×œ ×‘-validation!

### 2.2 ×”×©×¤×¢×•×ª

- âŒ ××™ ××¤×©×¨ ×œ×××Ÿ ××•×“×œ ×¢×œ scRNA (3 ×“×•×’×××•×ª)
- âŒ ××™ ××¤×©×¨ ×œ×‘×“×•×§ ×‘×™×¦×•×¢×™× ×¢×œ scRNA ×‘-validation
- âŒ Cross-validation ×™×™×›×©×œ ×¢×œ ×§×œ××¡×™× × ×“×™×¨×™×
- âŒ ×”×ª×¤×œ×’×•×ª ×©×•× ×” ×‘×™×Ÿ train/test/validation

### 2.3 ×¤×ª×¨×•× ×•×ª ××•××œ×¦×™×

#### ×. **××™×–×•×’ ×§×œ××¡×™×** (×”××œ×¦×” ×¢×™×§×¨×™×ª):
```python
# ××™×–×•×’ ×§×œ××¡×™× × ×“×™×¨×™× ×œ×§×˜×’×•×¨×™×” ××—×ª
rare_classes = ['scRNA', 'snRNA', 'rRNA']
df['GeneType_grouped'] = df['GeneType'].apply(
    lambda x: 'smallRNA' if x in rare_classes else x
)
```

#### ×‘. **×”×¡×¨×ª ×§×œ××¡×™× × ×“×™×¨×™× ×××•×“**:
```python
# ×”×¡×¨×ª scRNA (×¨×§ 3-4 ×“×•×’×××•×ª)
df = df[df['GeneType'] != 'scRNA']
```

#### ×’. **Stratified Sampling ××—×“×©**:
```python
from sklearn.model_selection import train_test_split

# ×—×œ×•×§×” ×©××©××¨×ª ×™×—×¡×™×
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, stratify=y, random_state=42
)
```

---

## 3. ğŸŸ  ×‘×¢×™×”: Data Leakage (×“×œ×™×¤×ª ××™×“×¢)

### 3.1 ×ª×™××•×¨ ×”×‘×¢×™×”

**Description ××›×™×œ ××ª ×”×ª×©×•×‘×” (GeneType) ×‘×ª×•×›×•!**

| ××™×œ×” ×‘-Description | GeneType | ×§×•×¨×œ×¦×™×” |
|-------------------|----------|---------|
| "pseudogene" | PSEUDO | 99.9% |
| "microRNA" | ncRNA | 100% |
| "regulatory region" | BIOLOGICAL_REGION | 100% |
| "enhancer" | BIOLOGICAL_REGION | 100% |

### 3.2 ×”×©×¤×¢×•×ª

- âŒ ××•×“×œ NLP ×™×§×‘×œ Accuracy ××•×©×œ× ×œ×œ× ×œ××™×“×” ×××™×ª×™×ª
- âŒ ×”××•×“×œ ×œ× ×™×œ××“ ×××¤×™×™× ×™× ×©×œ ×¨×¦×¤×™ × ×•×§×œ×™××•×˜×™×“×™×
- âŒ ×‘×™×¦×•×¢×™× ×× ×•×¤×—×™× ×©×œ× ×™×©×ª×§×¤×• ×‘××¦×™××•×ª

### 3.3 ×¤×ª×¨×•× ×•×ª ××•××œ×¦×™×

#### ×. **×œ× ×œ×”×©×ª××© ×‘-Description ×œ×—×™×–×•×™ GeneType**:
```python
# ×¨×§ ×¨×¦×¤×™ × ×•×§×œ×™××•×˜×™×“×™×
features = ['NucleotideSequence']
target = 'GeneType'
```

#### ×‘. **× ×™×§×•×™ Description ×××™×œ×•×ª ××¤×ª×—**:
```python
leaky_words = ['pseudogene', 'microRNA', 'regulatory', 'enhancer', 
               'small nucleolar', 'tRNA', 'protein coding']

def clean_description(desc):
    for word in leaky_words:
        desc = desc.lower().replace(word.lower(), '[REMOVED]')
    return desc
```

#### ×’. **×©×™××•×© ×¨×§ ×‘-Symbol (×§×•×¨×œ×¦×™×” 70-85%)**:
```python
# ×§×•×¨×œ×¦×™×” × ××•×›×” ×™×•×ª×¨ - ×œ××™×“×” ×××™×ª×™×ª ×™×•×ª×¨
features = ['Symbol', 'NucleotideSequence']
```

---

## 4. ğŸŸ  ×‘×¢×™×”: ×¨×¦×¤×™× ×§×¦×¨×™×/×§×™×¦×•× ×™×™×

### 4.1 ×ª×™××•×¨ ×”×‘×¢×™×”

× ××¦××• **5 ×¨×¦×¤×™× ×§×¦×¨×™× ×××•×“** (×¤×—×•×ª ×-10 ×‘×¡×™×¡×™×):

| ×©×•×¨×” | Symbol | ××•×¨×š ×¨×¦×£ | ×ª×•×›×Ÿ |
|------|--------|----------|------|
| 2566 | LOC107195252 | 2 | `<TT>` |
| 20544 | LOC107133518 | 4 | `<TACT>` |
| 11224 | LOC107133517 | 7 | `<CTGGGAT>` |
| 17652 | TRDD1 | 8 | `<GAAATAGT>` |
| 12981 | TRDD2 | 9 | `<CCTTCCTAC>` |

### 4.2 ×”×ª×¤×œ×’×•×ª ××•×¨×›×™ ×¨×¦×¤×™×:

| ×˜×•×•×— ××•×¨×š | ×›××•×ª | ××—×•×– |
|-----------|------|------|
| 1-20 bp | 25 | 0.1% |
| 21-50 bp | 88 | 0.4% |
| 51-100 bp | 3,356 | 14.9% |
| 101-200 bp | 3,814 | 16.9% |
| 201-500 bp | 9,359 | 41.4% |
| 501+ bp | 5,951 | 26.3% |

### 4.3 ×”×©×¤×¢×•×ª

- âŒ ×¨×¦×¤×™× ×§×¦×¨×™× ×××•×“ ×—×¡×¨×™ ××©××¢×•×ª ×‘×™×•×œ×•×’×™×ª
- âŒ ××•×“×œ×™× ×©×œ ×¨×¦×¤×™× (CNN, RNN) ×™×ª×§×©×• ×¢× ×©×•× ×•×ª ×’×‘×•×”×”
- âŒ Padding/Truncation ×™×¤×’×¢×• ×‘××™×“×¢

### 4.4 ×¤×ª×¨×•× ×•×ª ××•××œ×¦×™×

#### ×. **×¡×™× ×•×Ÿ ×¨×¦×¤×™× ×§×¦×¨×™× ××“×™**:
```python
MIN_SEQ_LENGTH = 20
df = df[df['NucleotideSequence'].str.len() >= MIN_SEQ_LENGTH]
```

#### ×‘. **Binning ×œ×¤×™ ××•×¨×š**:
```python
df['seq_length'] = df['NucleotideSequence'].str.len()
df['length_bin'] = pd.cut(df['seq_length'], 
                          bins=[0, 50, 100, 200, 500, float('inf')],
                          labels=['very_short', 'short', 'medium', 'long', 'very_long'])
```

#### ×’. **× ×¨××•×œ ××•×¨×š (Padding/Truncation)**:
```python
MAX_LENGTH = 500

def normalize_sequence(seq, max_len=MAX_LENGTH):
    seq = seq.strip('<>')
    if len(seq) > max_len:
        return seq[:max_len]  # Truncate
    return seq.ljust(max_len, 'N')  # Pad with N
```

---

## 5. ğŸŸ¡ ×‘×¢×™×”: ×ª×™××•×¨×™× ×œ× ××•×‘× ×™×

### 5.1 ×ª×™××•×¨ ×”×‘×¢×™×”

| ×¡×•×’ ×ª×™××•×¨ | ×›××•×ª | ××—×•×– |
|-----------|------|------|
| "uncharacterized LOC..." | 551 | 2.4% |
| ×›×œ "uncharacterized" | 589 | 2.6% |
| "putative..." | 61 | 0.3% |
| **×¡×”"×› ×œ× ×‘×¨×•×¨×™×** | ~650 | ~2.9% |

### 5.2 ×”×©×¤×¢×•×ª

- âŒ ××™×“×¢ ×—×¡×¨ ×¢×œ ×’× ×™× ××œ×•
- âŒ ×§×©×” ×œ×”×‘×™×Ÿ ××ª ×”×§×©×¨ ×‘×™×Ÿ Description ×œ-GeneType
- âŒ ××•×“×œ×™ NLP ×™×§×‘×œ×• ××™×“×¢ ×—×œ×§×™

### 5.3 ×¤×ª×¨×•× ×•×ª ××•××œ×¦×™×

```python
# ×¡×™××•×Ÿ ×’× ×™× ×œ× ×××•×¤×™×™× ×™×
df['is_uncharacterized'] = df['Description'].str.contains(
    'uncharacterized|putative|unknown', case=False
)

# ××•: ×”×—×œ×¤×” ×‘×§×˜×’×•×¨×™×” ××™×•×—×“×ª
df.loc[df['is_uncharacterized'], 'Description'] = 'UNCHARACTERIZED_GENE'
```

---

## 6. ğŸŸ¡ ×‘×¢×™×”: ×—×¤×™×¤×” ×‘×™×Ÿ ××¢×¨×›×™× (Data Leakage)

### 6.1 ×ª×™××•×¨ ×”×‘×¢×™×”

× ××¦××” **×—×¤×™×¤×” ×©×œ NCBIGeneID** ×‘×™×Ÿ ×”××¢×¨×›×™×:

```
×“×•×’××”: GeneID 123477792 ××•×¤×™×¢ ×’× ×‘-train ×•×’× ×‘-test
```

### 6.2 ×”×©×¤×¢×•×ª

- âŒ ××•×ª×Ÿ ×“×•×’×××•×ª ×‘-train ×•×‘-test = ×”×¢×¨×›×” ××•×¤×˜×™××™×ª
- âŒ ×”××•×“×œ "×–×•×›×¨" ×‘××§×•× ×œ×•××“
- âŒ ×‘×™×¦×•×¢×™ test ×œ× ××©×§×¤×™× generalization

### 6.3 ×¤×ª×¨×•×Ÿ

```python
# ×‘×“×™×§×ª ×—×¤×™×¤×”
train_ids = set(train_df['NCBIGeneID'])
test_ids = set(test_df['NCBIGeneID'])
overlap = train_ids.intersection(test_ids)

print(f"Overlap: {len(overlap)} genes")

# ×”×¡×¨×ª ×—×¤×™×¤×” ×-test
test_df = test_df[~test_df['NCBIGeneID'].isin(train_ids)]
```

---

## 7. ğŸŸ¢ ×‘×“×™×§×•×ª ×©×¢×‘×¨×• ×‘×”×¦×œ×—×”

| ×‘×“×™×§×” | ×ª×•×¦××” |
|-------|-------|
| âœ… ×¢×¨×›×™× ×—×¡×¨×™× (Missing Values) | **0** ×©×“×•×ª ×¨×™×§×™× |
| âœ… ×ª×•×•×™× ×œ× ×—×•×§×™×™× ×‘×¨×¦×¤×™× | **0** (×¨×§ A,T,G,C) |
| âœ… NCBIGeneID ×™×™×—×•×“×™ | **100%** ×™×™×—×•×“×™×•×ª |
| âœ… ×¤×•×¨××˜ CSV ×ª×§×™×Ÿ | **×ª×§×™×Ÿ** |

---

## 8. ğŸ“Š ×¡×™×›×•× ××˜×¨×™×¦×ª ×‘×¢×™×•×ª ×•×¤×ª×¨×•× ×•×ª

| ×‘×¢×™×” | ×—×•××¨×” | ×¤×ª×¨×•×Ÿ ××•××œ×¥ | ×¢×“×™×¤×•×ª |
|------|--------|-------------|--------|
| Class Imbalance | ğŸ”´ | SMOTE + Class Weights | **1** |
| Rare Classes (scRNA) | ğŸ”´ | ××™×–×•×’/×”×¡×¨×” | **2** |
| Data Leakage (Description) | ğŸŸ  | ×œ× ×œ×”×©×ª××© ×‘-Description | **3** |
| ×¨×¦×¤×™× ×§×¦×¨×™× | ğŸŸ  | ×¡×™× ×•×Ÿ MIN_LENGTH=20 | **4** |
| ×ª×™××•×¨×™× ×œ× ××•×‘× ×™× | ğŸŸ¡ | ×¡×™××•×Ÿ ×›×§×˜×’×•×¨×™×” | **5** |
| ×—×¤×™×¤×ª ××¢×¨×›×™× | ğŸŸ¡ | ×‘×“×™×§×” ×•×”×¡×¨×” | **6** |

---

## 9. ğŸ“ ×§×•×“ ××•××œ×¥ ×œ× ×™×§×•×™ × ×ª×•× ×™×

```python
import pandas as pd
import numpy as np
from imblearn.over_sampling import SMOTE
from sklearn.utils.class_weight import compute_class_weight

def clean_gene_data(df):
    """
    × ×™×§×•×™ ××œ× ×©×œ ××¢×¨×š ×”× ×ª×•× ×™×
    """
    # 1. ×”×¡×¨×ª ×¢××•×“×•×ª ××™×•×ª×¨×•×ª
    df = df.drop(columns=['Unnamed: 0', 'GeneGroupMethod'], errors='ignore')
    
    # 2. ×”×¡×¨×ª ×¨×¦×¤×™× ×§×¦×¨×™× ××“×™
    df['seq_length'] = df['NucleotideSequence'].str.replace('<|>', '', regex=True).str.len()
    df = df[df['seq_length'] >= 20]
    
    # 3. ××™×–×•×’ ×§×œ××¡×™× × ×“×™×¨×™×
    rare_rna = ['scRNA', 'snRNA', 'rRNA']
    df['GeneType_clean'] = df['GeneType'].apply(
        lambda x: 'smallRNA' if x in rare_rna else x
    )
    
    # 4. ×¡×™××•×Ÿ ×’× ×™× ×œ× ×××•×¤×™×™× ×™×
    df['is_uncharacterized'] = df['Description'].str.contains(
        'uncharacterized|putative', case=False, na=False
    )
    
    # 5. ×—×™×©×•×‘ features × ×•×¡×¤×™×
    df['gc_content'] = df['NucleotideSequence'].apply(calculate_gc)
    
    return df

def calculate_gc(seq):
    """×—×™×©×•×‘ ××—×•×– GC ×‘×¨×¦×£"""
    seq = seq.replace('<', '').replace('>', '')
    if len(seq) == 0:
        return 0
    gc = (seq.count('G') + seq.count('C')) / len(seq)
    return round(gc, 4)

# ×©×™××•×©:
# df_clean = clean_gene_data(df)
```

---

## 10. ğŸ¯ ×”××œ×¦×•×ª ×¡×•×¤×™×•×ª

### ×œ×¤× ×™ ×‘× ×™×™×ª ××•×“×œ:
1. âœ… ×”×¡×¨ `GeneGroupMethod` ×•-Index
2. âœ… ××–×’ ×§×œ××¡×™× × ×“×™×¨×™× (scRNA, snRNA, rRNA â†’ smallRNA)
3. âœ… ×¡× ×Ÿ ×¨×¦×¤×™× ×§×¦×¨×™× ×-20bp
4. âš ï¸ ××œ ×ª×©×ª××© ×‘-Description ×œ×—×™×–×•×™ GeneType
5. âœ… ×”×©×ª××© ×‘-Class Weights ××• SMOTE

### ××“×“×™ ×”×¢×¨×›×” ××•××œ×¦×™×:
- **×œ× ×œ×”×©×ª××© ×‘-Accuracy** (××˜×¢×” ×‘×’×œ×œ imbalance)
- âœ… **F1-Score (macro)** - ×××•×¦×¢ ×¢×œ ×›×œ ×”×§×œ××¡×™×
- âœ… **Confusion Matrix** - ×œ×–×”×•×ª ×˜×¢×•×™×•×ª ×¡×¤×¦×™×¤×™×•×ª
- âœ… **ROC-AUC (One-vs-Rest)** - ×œ×”×©×•×•××ª ×§×œ××¡×™×

---

**×¡×•×£ ×”×“×•×—**

